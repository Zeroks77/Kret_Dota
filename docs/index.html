<!doctype html>
<html lang='en'>
<head>
<meta charset='utf-8'>
<meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Kret&#39;s EU Dota League - Reports</title>
<link href='https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap' rel='stylesheet'>
<style>
:root{--bg:#0b1020;--panel:#121832;--muted:#9aa3b2;--text:#eef1f7;--accent:#6da6ff;--chip:#1a2142;--border:rgba(255,255,255,.08)}
*{box-sizing:border-box}
body{margin:0;background:radial-gradient(1200px 600px at 10% -10%, #172045, transparent 60%), var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;height:100vh;display:flex}
.sidebar{width:360px;min-width:280px;max-width:420px;background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));border-right:1px solid var(--border);padding:16px;display:flex;flex-direction:column;gap:12px}
.brand h1{font-size:20px;margin:0}
.sub{color:var(--muted);font-size:13px}
.filters{display:flex;flex-wrap:wrap;gap:6px}
.btn{padding:6px 10px;border:1px solid var(--border);border-radius:10px;background:#0e1533;color:var(--text);cursor:pointer;font-size:12px}
.btn.active{outline:2px solid rgba(109,166,255,.6)}
.search{width:100%;padding:8px 10px;border-radius:10px;border:1px solid var(--border);background:rgba(255,255,255,.04);color:var(--text);outline:none}
.list{margin:0;padding:0;list-style:none;overflow:auto;border:1px solid var(--border);border-radius:12px;flex:1;background:rgba(255,255,255,.02)}
.item a{display:block;padding:10px 12px;color:var(--text);text-decoration:none;border-bottom:1px solid rgba(255,255,255,.06)}
.item a:hover{background:rgba(255,255,255,.06)}
.item.active a{background:rgba(109,166,255,.18)}
.viewer{flex:1;display:flex;flex-direction:column}
.viewerbar{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--border);background:rgba(255,255,255,.03)}
.viewerbar .title{font-weight:600}
.viewerbar .nav{display:flex;gap:8px}
.nav .btn{padding:6px 10px}
iframe{border:0;flex:1;width:100%}
a{color:var(--accent)}
.has-hover{position:relative}
.hovercard{display:none;position:absolute;left:0;top:100%;margin-top:6px;z-index:5;min-width:260px;max-width:420px;padding:10px;border-radius:10px;background:rgba(15,20,40,.96);border:1px solid rgba(255,255,255,.12);box-shadow:0 8px 24px rgba(0,0,0,.35)}
.hovercard .title{font-weight:600;color:var(--muted);font-size:12px;margin-bottom:6px}
.hovercard a{display:inline-block;margin:2px 6px 2px 0;background:var(--chip);padding:3px 8px;border-radius:999px}
.has-hover:hover > .hovercard{display:block}
/* Hero gallery inside hovercard */
.hovercard .heroes{max-width:520px}
</style>
</head>
<body>
  <aside class='sidebar'>
    <div class='brand'>
      <h1>Reports - Kret&#39;s EU Dota League</h1>
      <div class='sub'>Pick a run or filter by range.</div>
    </div>
  <!-- Filters removed; Dynamic view is available as a pinned list entry below -->
    <input id='q' class='search' type='text' placeholder='Search (date/range) ...'>
    <ul id='list' class='list'>
      <li class="item" data-range="dynamic" data-time="9223372036854775807"><a href="./dynamic.html">Dynamic view (custom timeframe)</a></li>
    </ul>
  </aside>

  <main class='viewer'>
    <div class='viewerbar'>
      <div class='title' id='viewerTitle'>-</div>
      <div class='nav'>
        <button class='btn' id='prevBtn' title='Previous (ArrowUp)'><- Previous</button>
        <button class='btn' id='nextBtn' title='Next (ArrowDown)'>Next -></button>
        <a class='btn' id='openNew' target='_blank' rel='noopener'>Open in new tab</a>
      </div>
    </div>
    
    <iframe id='frame' src='about:blank' loading='eager' referrerpolicy='no-referrer'></iframe>
  </main>

<script>
(function(){
  const list = document.getElementById('list');
  let items = Array.from(list.querySelectorAll('.item'));
  const q = document.getElementById('q');
  const frame = document.getElementById('frame');
  const title = document.getElementById('viewerTitle');
  const openNew = document.getElementById('openNew');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  let selIndex = -1;

  function vis(){ return items.filter(li => li.style.display !== 'none'); }
  function txt(li){ const a=li.querySelector('a'); return a ? a.textContent.trim() : li.getAttribute('data-range'); }

  function apply(){
    const term = q.value.trim().toLowerCase(); let n=0;
    items.forEach(li=>{
      const t = txt(li).toLowerCase();
      const ok = (!term || t.includes(term));
      li.style.display = ok ? '' : 'none'; if (ok) n++;
    });
    if (n===0){ selIndex=-1; frame.src='about:blank'; title.textContent='No results'; openNew.removeAttribute('href'); }
    else if (selIndex<0){ select(0); }
    sync();
  }
  function select(i){
    const v = vis(); if (!v.length) return;
    if (i<0) i=0; if (i>=v.length) i=v.length-1;
    v.forEach(li => li.classList.remove('active'));
    const li=v[i]; li.classList.add('active');
    const a=li.querySelector('a');
    if (a){ const href=a.getAttribute('href'); frame.src=href; title.textContent=a.textContent.trim(); openNew.setAttribute('href',href); history.replaceState(null,'','#file='+encodeURIComponent(href)); }
    selIndex=i; li.scrollIntoView({block:'nearest'}); sync();
  }
  function sync(){ const v=vis(); prevBtn.disabled = (selIndex<=0 || !v.length); nextBtn.disabled = (selIndex>=v.length-1 || !v.length); }

  function wireItemClicks(){
    items.forEach(li=>li.addEventListener('click', e=>{e.preventDefault(); const v=vis(); const idx=v.indexOf(li); if (idx>=0) select(idx);}));
  }
  wireItemClicks();
  q.addEventListener('input', apply);
  prevBtn.addEventListener('click', ()=> select(selIndex-1));
  nextBtn.addEventListener('click', ()=> select(selIndex+1));
  document.addEventListener('keydown', ev=>{ if (ev.key==='ArrowUp'){ev.preventDefault(); select(selIndex-1);} if (ev.key==='ArrowDown'){ev.preventDefault(); select(selIndex+1);} });

  async function loadReports(){
    try {
      const res = await fetch('./reports.json', { cache: 'no-store' });
      if (!res.ok) throw new Error('HTTP '+res.status);
      const data = await res.json();
      if (!data || !Array.isArray(data.items)) return;
      // Remove old items except the pinned dynamic one
      const pinned = list.querySelectorAll('li.item');
      const keep = pinned[0];
      list.innerHTML = '';
      if (keep) list.appendChild(keep);

      // Group and sort: monthly (desc by sort or time), then patch (desc), then others
      const itemsArr = data.items.slice();
      function safeDate(x){ const t = Date.parse(x?.time||''); return isFinite(t)?t:0; }
      function groupOrder(g){ if(g==='monthly') return 0; if(g==='patch') return 1; return 2; }
      itemsArr.sort((a,b)=>{
        const go = groupOrder(a.group)-groupOrder(b.group);
        if (go!==0) return go;
        // Prefer sort key desc if both present and in same group
        if (a.group==='monthly' && b.group==='monthly' && a.sort && b.sort){
          return a.sort<b.sort?1:(a.sort>b.sort?-1:0);
        }
        if (a.group==='patch' && b.group==='patch' && a.sort && b.sort){
          return a.sort<b.sort?1:(a.sort>b.sort?-1:0);
        }
        return safeDate(b)-safeDate(a);
      });

      for (const it of itemsArr){
        const li = document.createElement('li');
        li.className = 'item';
        li.setAttribute('data-range', it.group||'report');
        li.setAttribute('data-time', String(safeDate(it)));
        const a = document.createElement('a');
        a.href = it.href || '#';
        a.textContent = it.title || it.href || 'Report';
        li.appendChild(a);
        list.appendChild(li);
      }
      items = Array.from(list.querySelectorAll('.item'));
      wireItemClicks();
    } catch (e) {
      // ignore; fallback to static pinned entry
    }
  }

  async function init(){
    await loadReports();
    const file = new URLSearchParams(location.hash.replace(/^#/, '')).get('file');
    if (file){ const t=items.find(li => li.querySelector('a')?.getAttribute('href')===file); if (t){ const v=items; const idx=v.indexOf(t); if (idx>=0){ select(idx); return; } } }
    apply();
  }
  init();
})();
</script>
</body>
</html>
